// Dados iniciais (simulando um banco de dados JSON)
let initiatives = [
    {
        "Iniciativas": "NCPI Dissemina",
        "O que é": "O NCPI Dissemina é a iniciativa voltada a ampliar a capacidade do NCPI disseminar evidências e conhecimentos científicos plurais com potencial de impacto sobre o desenho e a implementação de políticas públicas voltadas às Primeiras Infâncias.",
        "Descrição": "Canais e produtos voltados a levar evidências científicas para formuladores de políticas e agentes de implementação que atuam para aterrissar as políticas públicas e para desenvolver serviços públicos para as crianças na primeira infância.",
        "Resultados": [
            "NCPI visto como top referência sobre evidências para desenho e implementação de PPPI",
            "Públicos prioritários com acesso a informação atualizada e útil sobre implementação de PPPI"
        ],
        "Metas": [
            {
                "texto": "Manter o site do NCPI entre os 3 primeiros colocados no Google em buscas de expressões prioritárias",
                "semestre": "1º Semestre 2025",
                "status": "Em andamento",
                "progresso": 60
            },
            {
                "texto": "Aumentar a diversidade étnico-racial e regional de fontes sugeridas para entrevistas a veículos Tier 1",
                "semestre": "1º Semestre 2025",
                "status": "Em andamento",
                "progresso": 40
            },
            {
                "texto": "Obter espaço editorial fixo para ao menos 2 integrantes do CC, com diversidade étnico-racial, regional e epistemológica",
                "semestre": "2º Semestre 2025",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "Aumentar base de inscrições na newsletter em X% ao ano com taxa média de abertura de 20% ao ano",
                "semestre": "1º Semestre 2026",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "5 X% de crescimento de menções ao NCPI e seus produtos na imprensa",
                "semestre": "2º Semestre 2025",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "X% de crescimento de seguidores no LinkedIn",
                "semestre": "1º Semestre 2026",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "12 produtos derivados do CC ao longo dos 3 anos",
                "semestre": "2º Semestre 2026",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "10 produtos derivados do Prêmio",
                "semestre": "1º Semestre 2027",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "8 produtos derivados do Simpósio",
                "semestre": "2º Semestre 2026",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "6 encontros de disseminação com Comunidade NCPI (3 online e 3 presenciais)",
                "semestre": "1º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Participação de pesquisadores e/ou distribuição de materiais em ao menos 2 eventos estratégicos por ano",
                "semestre": "2º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            }
        ],
        "FAROL_NO_TRIMESTRE": "Em Andamento",
        "LÍDER": "Ana Silva",
        "OBSERVAÇÕES": "Iniciativa prioritária para o primeiro semestre",
        "Porta": "Porta para fora"
    },
    {
        "Iniciativas": "Simpósio Internacional",
        "O que é": "O Simpósio é evento voltado à sensibilização de gestores públicos, lideranças da sociedade civil e da academia por meio de evidências para a qualificação da implementação de políticas públicas de primeira infância.",
        "Descrição": "Encontro que apresenta evidências científicas e boas práticas capazes de pautar o debate público sobre políticas públicas para as primeiras infâncias, considerando a diversidade brasileira com vistas a contribuir para a tomada de decisão de gestores públicos.",
        "Resultados": [
            "Simpósio como espaço agregador das principais pautas e tendências de implementação de PPPI",
            "Perfil de palestrantes e participantes orientado pelas diversidades regional e étnico-racial brasileiras"
        ],
        "Metas": [
            {
                "texto": "80% dos Participantes afirmam que participar do Simpósio ampliou seus conhecimentos sobre Pi e suas conexões com atores do campo",
                "semestre": "2º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "1 encontro da Comunidade NCPI por edição do Simpósio",
                "semestre": "1º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Ao menos 5 side events por edição",
                "semestre": "2º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Participação de 3 a 5 palestrantes internacionais, com 50% deles com origem no Sul Global",
                "semestre": "1º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Ao menos 1 estudo científico inédito lançado no Simpósio",
                "semestre": "2º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "100% dos estados brasileiros com participantes presencial e/ou on-line",
                "semestre": "1º Semestre 2027",
                "status": "Em andamento",
                "progresso": 75
            },
            {
                "texto": "30% do público advindo do N ou NE, sendo pretos, pardos e indígenas",
                "semestre": "2º Semestre 2026",
                "status": "Em andamento",
                "progresso": 50
            },
            {
                "texto": "300 participantes presenciais e ao menos 1000 online",
                "semestre": "1º Semestre 2027",
                "status": "Em andamento",
                "progresso": 30
            },
            {
                "texto": "50% de participantes advindos da academia, OSC e imprensa",
                "semestre": "2º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "50% de gestores públicos de alto e médio escalão + nível de rua",
                "semestre": "1º Semestre 2027",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "40% dos palestrantes entre pessoas pretas, pardas e indígenas",
                "semestre": "2º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            }
        ],
        "FAROL_NO_TRIMESTRE": "No Prazo",
        "LÍDER": "Carlos Oliveira",
        "OBSERVAÇÕES": "Preparativos para o evento de outubro em andamento",
        "Porta": "Porta para fora"
    },
    {
        "Iniciativas": "Prêmio",
        "O que é": "O Prêmio identifica e reconhece pesquisadores que abordam as múltiplas infâncias e desigualdades nas primeiras infâncias brasileiras.",
        "Descrição": "Premiação que identifica e reconhece pesquisadores relacionados às primeiras infâncias, visando fortalecer a produção, disseminação e uso de evidências para apoiar a formulação e qualificação de políticas públicas em primeira infância no Brasil.",
        "Resultados": [
            "Todas as etapas da premiação com garantia de diversidade epistêmica, geográfica e racial",
            "Pesquisas premiadas articuladas com a gestão pública e inserção na imprensa"
        ],
        "Metas": [
            {
                "texto": "50% de participantes do N e NE em todas as etapas de cada edição",
                "semestre": "1º Semestre 2025",
                "status": "Em andamento",
                "progresso": 35
            },
            {
                "texto": "50% de participantes pretos, pardos e indígenas em todas as etapas",
                "semestre": "2º Semestre 2025",
                "status": "Em andamento",
                "progresso": 40
            },
            {
                "texto": "Pesquisas distribuídas pelas diferentes área de concentração",
                "semestre": "1º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Assegurar ao menos 5 parceiros divulgadores a cada edição: FNP, RNPI, CNM, CPAPI, etc.",
                "semestre": "2º Semestre 2025",
                "status": "Em andamento",
                "progresso": 60
            },
            {
                "texto": "50% da comissão julgadora do Prêmio formada por preto, pardos e indígenas",
                "semestre": "1º Semestre 2026",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "1 formação em comunicação e influência para todos os finalistas",
                "semestre": "2º Semestre 2026",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "1 formação em aplicação de evidências às PP para os premiados",
                "semestre": "1º Semestre 2027",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "50 gestores públicos e de OSC presentes na cerimônia de premiação",
                "semestre": "2º Semestre 2026",
                "status": "Não iniciada",
                "progresso": 0
            },
            {
                "texto": "Ao menos 50% das pesquisas inscritas voltadas às crianças pretas, pardas e indígenas",
                "semestre": "1º Semestre 2027",
                "status": "Concluída",
                "progresso": 100
            }
        ],
        "FAROL_NO_TRIMESTRE": "Em Risco",
        "LÍDER": "Mariana Santos",
        "OBSERVAÇÕES": "Necessário ampliar divulgação para atingir meta de inscrições",
        "Porta": "Porta para fora"
    },
    {
        "Iniciativas": "ELP",
        "O que é": "A formação executiva, desenvolvida em parceria com a Escola de Saúde Pública da Universidade Harvard, busca mobilizar e capacitar lideranças para qualificar a criação e implementação de políticas.",
        "Descrição": "Formação para sensibilizar, mobilizar e capacitar lideranças de alto nível para qualificar a elaboração e implementação de políticas, programas e ações voltados ao desenvolvimento das primeiras infâncias no Brasil.",
        "Resultados": [
            "Lideranças sensibilizadas e engajadas a implementar PP voltadas às múltiplas infâncias brasileiras",
            "Participantes e docentes pretos, pardos e indígenas presentes de modo significativo no ELP"
        ],
        "Metas": [
            {
                "texto": "80% dos participantes avaliam seus argumentos e evidências sobre PI como excelente/bom",
                "semestre": "1º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "80% dos participantes avaliam suas habilidades de mobilizar agentes a favor da PI como excelente/bom",
                "semestre": "2º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "80% dos participantes avaliam seu conhecimento para implementar políticas públicas de PI como excelente/bom",
                "semestre": "1º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "NPS do Programa acima de 90%",
                "semestre": "2º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "90% dos plano de ação apresentados com recortes das múltiplas infâncias brasileiras",
                "semestre": "1º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Ao menos 70% dos planos de ação em algum estágio de implementação",
                "semestre": "2º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Mínimo de 40% dos participantes pretos, pardos e indígenas",
                "semestre": "1º Semestre 2027",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Assegurar ao menos 15% de participantes para as 5 regiões brasileiras",
                "semestre": "2º Semestre 2026",
                "status": "Em andamento",
                "progresso": 80
            },
            {
                "texto": "40% de diversidade nos professores de todas as etapas",
                "semestre": "1º Semestre 2027",
                "status": "Em andamento",
                "progresso": 65
            },
            {
                "texto": "Ao menos 50% dos participantes ocupam posições de liderança na gestão pública",
                "semestre": "2º Semestre 2026",
                "status": "Em andamento",
                "progresso": 75
            }
        ],
        "FAROL_NO_TRIMESTRE": "No Prazo",
        "LÍDER": "Roberto Almeida",
        "OBSERVAÇÕES": "Turma atual com excelente engajamento",
        "Porta": "Porta para dentro"
    },
    {
        "Iniciativas": "MOBILIZAÇÃO E GESTÃO DE RECURSOS FINANCEIROS",
        "Descrição": "Gestão de recursos financeiros para garantir a sustentabilidade das iniciativas",
        "Resultados": [
            "Fases V e VI financiadas, com novos parceiros que fortaleçam a coalizão e as iniciativas",
            "Gestão financeira precisa, eficiente e transparente assegurada ao longo da Fase V"
        ],
        "Metas": [
            {
                "texto": "100% dos grants previstos, aprovados com os parceiros",
                "semestre": "1º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Fase V com orçamento garantido",
                "semestre": "2º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "Prospecção de ao menos 1 parceiro para a fase 6.",
                "semestre": "2º Semestre 2025",
                "status": "Em andamento",
                "progresso": 70
            },
            {
                "texto": "100% dos relatórios financeiros aprovados pelos parceiros",
                "semestre": "1º Semestre 2026",
                "status": "Concluída",
                "progresso": 100
            },
            {
                "texto": "100% dos compromissos financeiros executados",
                "semestre": "2º Semestre 2026",
                "status": "Em andamento",
                "progresso": 85
            },
            {
                "texto": "Acompanhamento mensal do orçamento realizado pela equipe",
                "semestre": "1º Semestre 2025",
                "status": "Concluída",
                "progresso": 100
            }
        ],
        "FAROL_NO_TRIMESTRE": "No Prazo",
        "LÍDER": "Fernanda Costa",
        "OBSERVAÇÕES": "Relatórios financeiros do trimestre entregues no prazo",
        "Porta": "Porta para dentro"
    }
];

// Variáveis globais
let currentInitiative = null;
let currentMetaIndex = null;
let metasList = [];
let resultadosList = [];
let allExpanded = false;
let activeFilters = ['all'];
let currentPage = 'all'; // 'all', 'porta-fora', 'porta-dentro'

// Elementos DOM
document.addEventListener('DOMContentLoaded', () => {
    // Inicializar elementos DOM
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebar');
    const mainContent = document.getElementById('mainContent');
    const initiativesList = document.getElementById('initiativesList');
    const searchInput = document.getElementById('searchInput');
    const expandAllBtn = document.getElementById('expandAllBtn');
    const filterBtn = document.getElementById('filterBtn');
    const editModal = document.getElementById('editModal');
    const editMetaModal = document.getElementById('editMetaModal');
    const filterModal = document.getElementById('filterModal');
    const closeModalBtns = document.querySelectorAll('.close-modal');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const saveEditBtn = document.getElementById('saveEditBtn');
    const cancelMetaEditBtn = document.getElementById('cancelMetaEditBtn');
    const saveMetaEditBtn = document.getElementById('saveMetaEditBtn');
    const cancelFilterBtn = document.getElementById('cancelFilterBtn');
    const applyFilterBtn = document.getElementById('applyFilterBtn');
    const addResultadoBtn = document.getElementById('addResultadoBtn');
    const addMetaBtn = document.getElementById('addMetaBtn');
    const exportBtn = document.getElementById('exportBtn');
    const exportDataBtn = document.getElementById('exportDataBtn');
    const menuDropdowns = document.querySelectorAll('.menu-dropdown');
    const submenuItems = document.querySelectorAll('.submenu-item');
    const metaProgressoInput = document.getElementById('metaProgresso');
    const progressoValueSpan = document.getElementById('progressoValue');

    // Carregar dados do localStorage se existirem
    const savedData = localStorage.getItem('initiatives');
    if (savedData) {
        initiatives = JSON.parse(savedData);
    }

    // Configurar menu dropdown
    menuDropdowns.forEach(dropdown => {
        const toggle = dropdown.querySelector('.dropdown-toggle');
        toggle.addEventListener('click', (e) => {
            e.preventDefault();
            dropdown.classList.toggle('open');
        });
    });

    // Configurar itens do submenu
    submenuItems.forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const page = e.currentTarget.getAttribute('data-page');
            navigateToPage(page);
        });
    });

    // Toggle sidebar
    toggleSidebarBtn.addEventListener('click', () => {
        sidebar.classList.toggle('collapsed');
        mainContent.classList.toggle('expanded');
    });

    // Inicializar a página
    loadInitiatives();
    updateStats();

    // Configurar event listeners
    searchInput.addEventListener('input', handleSearch);
    expandAllBtn.addEventListener('click', toggleExpandAll);
    filterBtn.addEventListener('click', openFilterModal);
    closeModalBtns.forEach(btn => btn.addEventListener('click', closeModals));
    cancelEditBtn.addEventListener('click', closeModals);
    saveEditBtn.addEventListener('click', saveInitiative);
    cancelMetaEditBtn.addEventListener('click', closeModals);
    saveMetaEditBtn.addEventListener('click', saveMetaEdit);
    cancelFilterBtn.addEventListener('click', closeModals);
    applyFilterBtn.addEventListener('click', applyFilters);
    addResultadoBtn.addEventListener('click', addResultado);
    addMetaBtn.addEventListener('click', addMeta);
    exportBtn.addEventListener('click', exportData);
    exportDataBtn.addEventListener('click', exportData);
    
    // Atualizar valor do progresso
    if (metaProgressoInput) {
        metaProgressoInput.addEventListener('input', () => {
            progressoValueSpan.textContent = metaProgressoInput.value;
        });
    }
    
    // Fechar modais ao clicar fora
    window.addEventListener('click', (e) => {
        if (e.target === editModal) {
            closeModals();
        }
        if (e.target === filterModal) {
            closeModals();
        }
        if (e.target === editMetaModal) {
            closeModals();
        }
    });
});

// Navegar para uma página específica
function navigateToPage(page) {
    currentPage = page;
    
    // Atualizar título da página
    const pageTitle = document.getElementById('pageTitle');
    const contentTitle = document.getElementById('contentTitle');
    const filterBadge = document.getElementById('filterBadge');
    
    switch (page) {
        case 'porta-fora':
            pageTitle.textContent = 'Painel da Estratégia - Porta para fora';
            contentTitle.textContent = 'Iniciativas - Porta para fora';
            filterBadge.textContent = 'Porta para fora';
            filterBadge.classList.add('active');
            break;
        case 'porta-dentro':
            pageTitle.textContent = 'Painel da Estratégia - Porta para dentro';
            contentTitle.textContent = 'Iniciativas - Porta para dentro';
            filterBadge.textContent = 'Porta para dentro';
            filterBadge.classList.add('active');
            break;
        default:
            pageTitle.textContent = 'Painel Estratégico';
            contentTitle.textContent = 'Objetivos Estratégicos';
            filterBadge.classList.remove('active');
            break;
    }
    
    // Carregar iniciativas filtradas
    loadInitiatives();
    updateStats();
}

// Carregar iniciativas na lista
function loadInitiatives(filteredList = null) {
    const initiativesList = document.getElementById('initiativesList');
    let list = filteredList || initiatives;
    
    // Filtrar por porta se necessário
    if (currentPage === 'porta-fora') {
